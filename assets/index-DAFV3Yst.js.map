{"version":3,"file":"index-DAFV3Yst.js","sources":["../../src/world-cesium/index.ts","../../src/aircraft-render/index.ts","../../src/input/index.ts","../../src/ui/index.ts","../../src/sim-core/index.ts","../../src/fdm-jsbsim/index.ts","../../src/frames/index.ts","../../src/index.ts"],"sourcesContent":["/**\n * world-cesium - Cesium Viewer Setup\n * \n * Uses Cesium from global CDN\n */\n\nimport type { Vector3, Quaternion } from '../sim-core/index';\n\ninterface CesiumViewer {\n  scene: any;\n  camera: any;\n  entities: any;\n  clock: any;\n  destroy(): void;\n}\n\ninterface CesiumConfig {\n  ionToken?: string;\n  terrainProvider?: string;\n  imageryProvider?: string;\n  enable3DTiles?: boolean;\n  tilesetUrl?: string;\n}\n\ninterface CameraMode {\n  type: 'chase' | 'cockpit' | 'free';\n  offset?: Vector3;\n  distance?: number;\n  fov?: number;\n}\n\nconst DEFAULT_CONFIG: CesiumConfig = {\n  terrainProvider: 'default',\n  imageryProvider: 'bing',\n  enable3DTiles: false\n};\n\nexport class CesiumWorld {\n  private viewer: CesiumViewer | null = null;\n  private aircraftEntity: any = null;\n  private cameraMode: CameraMode = { type: 'cockpit' };\n  private aircraftPosition: Vector3 = { x: 0, y: 0, z: 0 };\n  private aircraftOrientation: Quaternion = { x: 0, y: 0, z: 0, w: 1 };\n\n  async initialize(container: HTMLElement, config: CesiumConfig = {}): Promise<void> {\n    const cfg = { ...DEFAULT_CONFIG, ...config };\n    const Cesium = (window as any).Cesium;\n    \n    if (!Cesium) {\n      throw new Error('Cesium not loaded. Add Cesium CDN script to HTML.');\n    }\n\n    if (cfg.ionToken) {\n      Cesium.Ion.defaultAccessToken = cfg.ionToken;\n    }\n\n    this.viewer = new Cesium.Viewer(container, {\n      baseLayerPicker: false,\n      geocoder: false,\n      homeButton: false,\n      sceneModePicker: false,\n      selectionIndicator: false,\n      timeline: false,\n      animation: false,\n      navigationHelpButton: false,\n      fullscreenButton: false,\n      vrButton: false,\n      infoBox: false,\n      shouldAnimate: true\n    });\n  }\n\n  setAircraftModel(url: string): void {\n    if (!this.viewer) return;\n    const Cesium = (window as any).Cesium;\n\n    this.aircraftEntity = this.viewer.entities.add({\n      position: Cesium.Cartesian3.ZERO,\n      model: {\n        uri: url,\n        scale: 1.0,\n        minimumPixelSize: 64,\n        maximumScale: 50000\n      }\n    });\n  }\n\n  updateAircraft(position: Vector3, orientation: Quaternion): void {\n    if (!this.viewer || !this.aircraftEntity) return;\n    const Cesium = (window as any).Cesium;\n\n    const cesiumPos = Cesium.Cartesian3.fromElements(position.x, position.y, position.z);\n    const hpr = this.quaternionToHeadingPitchRoll(orientation);\n    \n    this.aircraftEntity.position = cesiumPos;\n    this.aircraftEntity.orientation = Cesium.Transforms.headingPitchRollQuaternion(\n      cesiumPos,\n      new Cesium.HeadingPitchRoll(hpr.heading, hpr.pitch, hpr.roll)\n    );\n\n    this.aircraftPosition = position;\n    this.aircraftOrientation = orientation;\n  }\n\n  private quaternionToHeadingPitchRoll(q: Quaternion): { heading: number; pitch: number; roll: number } {\n    const sinr_cosp = 2 * (q.w * q.x + q.y * q.z);\n    const cosr_cosp = 1 - 2 * (q.x * q.x + q.y * q.y);\n    const roll = Math.atan2(sinr_cosp, cosr_cosp);\n\n    const sinp = 2 * (q.w * q.y - q.z * q.x);\n    const pitch = Math.abs(sinp) >= 1 ? Math.sign(sinp) * Math.PI / 2 : Math.asin(sinp);\n\n    const siny_cosp = 2 * (q.w * q.z + q.x * q.y);\n    const cosy_cosp = 1 - 2 * (q.y * q.y + q.z * q.z);\n    const heading = Math.atan2(siny_cosp, cosy_cosp);\n\n    return { heading, pitch, roll };\n  }\n\n  setCameraMode(mode: CameraMode): void {\n    this.cameraMode = mode;\n  }\n\n  flyTo(longitude: number, latitude: number, height: number): void {\n    if (!this.viewer) return;\n    const Cesium = (window as any).Cesium;\n    \n    this.viewer.camera.flyTo({\n      destination: Cesium.Cartesian3.fromDegrees(longitude, latitude, height),\n      duration: 2\n    });\n  }\n\n  getViewer(): CesiumViewer | null {\n    return this.viewer;\n  }\n\n  destroy(): void {\n    if (this.viewer) {\n      this.viewer.destroy();\n      this.viewer = null;\n    }\n  }\n}\n","/**\n * aircraft-render - Aircraft GLB Loading & Rendering\n * \n * Simplified - uses Cesium entities\n */\n\nimport type { Vector3, Quaternion } from '../sim-core/index';\n\nexport interface AircraftModelConfig {\n  url: string;\n  scale: number;\n}\n\nexport interface PerformanceTier {\n  name: 'low' | 'medium' | 'high';\n  maxTriangles: number;\n  maxTextureSize: number;\n  modelScale: number;\n}\n\nconst PERFORMANCE_TIERS: Record<string, PerformanceTier> = {\n  low: { name: 'low', maxTriangles: 50000, maxTextureSize: 512, modelScale: 0.8 },\n  medium: { name: 'medium', maxTriangles: 150000, maxTextureSize: 1024, modelScale: 1.0 },\n  high: { name: 'high', maxTriangles: 500000, maxTextureSize: 4096, modelScale: 1.0 }\n};\n\nexport class AircraftRenderer {\n  private modelUrl: string;\n  private scale: number;\n  private currentTier: PerformanceTier;\n  private position: Vector3 = { x: 0, y: 0, z: 0 };\n  private orientation: Quaternion = { x: 0, y: 0, z: 0, w: 1 };\n\n  constructor(config: Partial<AircraftModelConfig> = {}) {\n    this.modelUrl = config.url || '';\n    this.scale = config.scale || 1.0;\n    this.currentTier = PERFORMANCE_TIERS['high'];\n  }\n\n  async load(cesiumEntities: any): Promise<void> {\n    if (!this.modelUrl) {\n      console.log('No aircraft model URL - using placeholder');\n      return;\n    }\n  }\n\n  update(position: Vector3, orientation: Quaternion): void {\n    this.position = position;\n    this.orientation = orientation;\n  }\n\n  setTier(tierName: 'low' | 'medium' | 'high'): void {\n    this.currentTier = PERFORMANCE_TIERS[tierName];\n    this.scale = this.currentTier.modelScale;\n  }\n\n  isLoaded(): boolean {\n    return true;\n  }\n\n  destroy(): void {\n  }\n}\n\nexport const A380_MODELS = {\n  high: '/assets/a380-high.glb',\n  medium: '/assets/a380-medium.glb',\n  low: '/assets/a380-low.glb'\n};\n\nexport function getModelForTier(tier: 'low' | 'medium' | 'high'): string {\n  return A380_MODELS[tier];\n}\n","/**\n * input - Control Input System\n * \n * Responsibilities:\n * - Desktop: keyboard/mouse + gamepad/joystick mapping\n * - Mobile: touch controls + gyro calibration + fallback\n * - Normalized control outputs: throttle, aileron, elevator, rudder, brakes, flaps, trim\n */\n\nimport type { FlightControls } from '../fdm-jsbsim/index';\n\nexport interface InputConfig {\n  enableKeyboard: boolean;\n  enableMouse: boolean;\n  enableGamepad: boolean;\n  enableTouch: boolean;\n  enableGyro: boolean;\n}\n\nexport interface GamepadState {\n  connected: boolean;\n  axes: number[];\n  buttons: boolean[];\n  id: string;\n}\n\nexport interface GyroState {\n  available: boolean;\n  alpha: number;   // Z-axis (yaw)\n  beta: number;   // X-axis (pitch)\n  gamma: number;  // Y-axis (roll)\n  calibrated: boolean;\n  calibrationOffset: { alpha: number; beta: number; gamma: number };\n}\n\nconst DEFAULT_CONFIG: InputConfig = {\n  enableKeyboard: true,\n  enableMouse: true,\n  enableGamepad: true,\n  enableTouch: true,\n  enableGyro: true\n};\n\n// Keyboard mapping\nconst KEY_MAP: Record<string, keyof FlightControls> = {\n  'KeyW': 'throttle',\n  'KeyS': 'throttle',\n  'KeyA': 'aileron',\n  'KeyD': 'aileron',\n  'ArrowUp': 'elevator',\n  'ArrowDown': 'elevator',\n  'ArrowLeft': 'rudder',\n  'ArrowRight': 'rudder',\n  'KeyF': 'flaps',\n  'KeyB': 'brakes',\n  'KeyG': 'gear'\n};\n\nexport class InputManager {\n  private config: InputConfig;\n  private controls: FlightControls = {\n    throttle: 0,\n    aileron: 0,\n    elevator: 0,\n    rudder: 0,\n    flaps: 0,\n    brakes: 0,\n    gear: 0\n  };\n\n  // Input state\n  private keys: Set<string> = new Set();\n  private mousePosition: { x: number; y: number } = { x: 0, y: 0 };\n  private mouseDelta: { x: number; y: number } = { x: 0, y: 0 };\n  private mouseButtons: Set<number> = new Set();\n  \n  // Gamepad\n  private gamepad: GamepadState | null = null;\n  \n  // Touch\n  private touchPoints: Map<number, { x: number; y: number }> = new Map();\n  private virtualJoystickLeft: { x: number; y: number; active: boolean } = { x: 0, y: 0, active: false };\n  private virtualJoystickRight: { x: number; y: number; active: boolean } = { x: 0, y: 0, active: false };\n  \n  // Gyro\n  private gyro: GyroState = {\n    available: false,\n    alpha: 0,\n    beta: 0,\n    gamma: 0,\n    calibrated: false,\n    calibrationOffset: { alpha: 0, beta: 0, gamma: 0 }\n  };\n\n  // Callbacks\n  private onControlChange: ((controls: FlightControls) => void) | null = null;\n\n  constructor(config: Partial<InputConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.setupEventListeners();\n  }\n\n  private setupEventListeners(): void {\n    // Keyboard\n    if (this.config.enableKeyboard) {\n      window.addEventListener('keydown', this.handleKeyDown);\n      window.addEventListener('keyup', this.handleKeyUp);\n    }\n\n    // Mouse\n    if (this.config.enableMouse) {\n      window.addEventListener('mousemove', this.handleMouseMove);\n      window.addEventListener('mousedown', this.handleMouseDown);\n      window.addEventListener('mouseup', this.handleMouseUp);\n    }\n\n    // Gamepad\n    if (this.config.enableGamepad) {\n      window.addEventListener('gamepadconnected', this.handleGamepadConnected);\n      window.addEventListener('gamepaddisconnected', this.handleGamepadDisconnected);\n    }\n\n    // Touch\n    if (this.config.enableTouch) {\n      window.addEventListener('touchstart', this.handleTouchStart);\n      window.addEventListener('touchmove', this.handleTouchMove);\n      window.addEventListener('touchend', this.handleTouchEnd);\n    }\n\n    // Gyro\n    if (this.config.enableGyro) {\n      this.initGyro();\n    }\n  }\n\n  // ============================================\n  // Event Handlers\n  // ============================================\n\n  private handleKeyDown = (e: KeyboardEvent): void => {\n    this.keys.add(e.code);\n    this.updateKeyboardControls();\n  };\n\n  private handleKeyUp = (e: KeyboardEvent): void => {\n    this.keys.delete(e.code);\n    this.updateKeyboardControls();\n  };\n\n  private handleMouseMove = (e: MouseEvent): void => {\n    this.mouseDelta.x = e.clientX - this.mousePosition.x;\n    this.mouseDelta.y = e.clientY - this.mousePosition.y;\n    this.mousePosition = { x: e.clientX, y: e.clientY };\n  };\n\n  private handleMouseDown = (e: MouseEvent): void => {\n    this.mouseButtons.add(e.button);\n  };\n\n  private handleMouseUp = (e: MouseEvent): void => {\n    this.mouseButtons.delete(e.button);\n  };\n\n  private handleGamepadConnected = (e: GamepadEvent): void => {\n    this.gamepad = {\n      connected: true,\n      axes: Array.from(e.gamepad.axes),\n      buttons: e.gamepad.buttons.map(b => b.pressed),\n      id: e.gamepad.id\n    };\n    console.log('Gamepad connected:', this.gamepad.id);\n  };\n\n  private handleGamepadDisconnected = (): void => {\n    this.gamepad = null;\n  };\n\n  private handleTouchStart = (e: TouchEvent): void => {\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      const touch = e.changedTouches[i];\n      this.touchPoints.set(touch.identifier, { x: touch.clientX, y: touch.clientY });\n    }\n    this.updateTouchControls();\n  };\n\n  private handleTouchMove = (e: TouchEvent): void => {\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      const touch = e.changedTouches[i];\n      const start = this.touchPoints.get(touch.identifier);\n      if (start) {\n        // Update virtual joystick positions\n        const dx = touch.clientX - start.x;\n        const dy = touch.clientY - start.y;\n        \n        if (touch.clientX < window.innerWidth / 2) {\n          // Left side - throttle/yaw\n          this.virtualJoystickLeft = {\n            x: Math.max(-1, Math.min(1, dx / 50)),\n            y: Math.max(-1, Math.min(1, dy / 50)),\n            active: true\n          };\n        } else {\n          // Right side - pitch/roll\n          this.virtualJoystickRight = {\n            x: Math.max(-1, Math.min(1, dx / 50)),\n            y: Math.max(-1, Math.min(1, dy / 50)),\n            active: true\n          };\n        }\n      }\n    }\n    this.updateTouchControls();\n  };\n\n  private handleTouchEnd = (e: TouchEvent): void => {\n    for (let i = 0; i < e.changedTouches.length; i++) {\n      const touch = e.changedTouches[i];\n      this.touchPoints.delete(touch.identifier);\n      \n      // Reset joystick when touch ends\n      if (touch.clientX < window.innerWidth / 2) {\n        this.virtualJoystickLeft.active = false;\n        this.virtualJoystickLeft.x = 0;\n        this.virtualJoystickLeft.y = 0;\n      } else {\n        this.virtualJoystickRight.active = false;\n        this.virtualJoystickRight.x = 0;\n        this.virtualJoystickRight.y = 0;\n      }\n    }\n    this.updateTouchControls();\n  };\n\n  private async initGyro(): Promise<void> {\n    try {\n      // Request permission for iOS\n      if (typeof (DeviceOrientationEvent as any).requestPermission === 'function') {\n        const response = await (DeviceOrientationEvent as any).requestPermission();\n        if (response !== 'granted') {\n          console.warn('Gyro permission denied');\n          return;\n        }\n      }\n\n      window.addEventListener('deviceorientation', this.handleGyro);\n      this.gyro.available = true;\n    } catch (e) {\n      console.warn('Gyro not available:', e);\n    }\n  };\n\n  private handleGyro = (e: DeviceOrientationEvent): void => {\n    if (!this.gyro.calibrated) {\n      // Calibrate on first reading\n      this.gyro.calibrationOffset = {\n        alpha: e.alpha || 0,\n        beta: e.beta || 0,\n        gamma: e.gamma || 0\n      };\n      this.gyro.calibrated = true;\n    }\n\n    this.gyro.alpha = (e.alpha || 0) - this.gyro.calibrationOffset.alpha;\n    this.gyro.beta = (e.beta || 0) - this.gyro.calibrationOffset.beta;\n    this.gyro.gamma = (e.gamma || 0) - this.gyro.calibrationOffset.gamma;\n  };\n\n  // ============================================\n  // Control Updates\n  // ============================================\n\n  private updateKeyboardControls(): void {\n    // Reset keyboard-driven controls\n    let throttle = 0;\n    let aileron = 0;\n    let elevator = 0;\n    let rudder = 0;\n\n    // Throttle (W/S or W/S keys)\n    if (this.keys.has('KeyW')) throttle = 1;\n    if (this.keys.has('KeyS')) throttle = -1;\n\n    // Aileron (A/D)\n    if (this.keys.has('KeyA')) aileron = -1;\n    if (this.keys.has('KeyD')) aileron = 1;\n\n    // Elevator (Arrow Up/Down)\n    if (this.keys.has('ArrowUp')) elevator = 1;\n    if (this.keys.has('ArrowDown')) elevator = -1;\n\n    // Rudder (Arrow Left/Right)\n    if (this.keys.has('ArrowLeft')) rudder = -1;\n    if (this.keys.has('ArrowRight')) rudder = 1;\n\n    // Flaps (F key - cycle)\n    const flaps = this.keys.has('KeyF') ? 1 : 0;\n    \n    // Brakes (B key)\n    const brakes = this.keys.has('KeyB') ? 1 : 0;\n\n    // Gear (G key)\n    const gear = this.keys.has('KeyG') ? 1 : 0;\n\n    this.controls = {\n      throttle,\n      aileron,\n      elevator,\n      rudder,\n      flaps,\n      brakes,\n      gear\n    };\n\n    this.notifyChange();\n  }\n\n  private updateGamepadControls(): void {\n    if (!this.gamepad || !this.config.enableGamepad) return;\n\n    const gamepads = navigator.getGamepads();\n    const gp = gamepads[0];\n    \n    if (!gp) return;\n\n    // Standard flight stick mapping\n    // Axes: 0=aileron, 1=elevator, 2=throttle, 3=rudder\n    this.controls.aileron = gp.axes[0] || 0;\n    this.controls.elevator = gp.axes[1] || 0;\n    this.controls.throttle = (gp.axes[2] + 1) / 2; // Normalize -1..1 to 0..1\n    this.controls.rudder = gp.axes[3] || 0;\n\n    // Buttons\n    if (gp.buttons[0]?.pressed) this.controls.flaps = 1;\n    if (gp.buttons[1]?.pressed) this.controls.brakes = 1;\n    if (gp.buttons[2]?.pressed) this.controls.gear = 1;\n  }\n\n  private updateTouchControls(): void {\n    if (!this.config.enableTouch) return;\n\n    // Left joystick: throttle (Y) + rudder (X)\n    if (this.virtualJoystickLeft.active) {\n      this.controls.throttle = -this.virtualJoystickLeft.y; // Inverted\n      this.controls.rudder = this.virtualJoystickLeft.x;\n    }\n\n    // Right joystick: aileron (X) + elevator (Y)\n    if (this.virtualJoystickRight.active) {\n      this.controls.aileron = this.virtualJoystickRight.x;\n      this.controls.elevator = -this.virtualJoystickRight.y; // Inverted\n    }\n  }\n\n  private updateGyroControls(): void {\n    if (!this.gyro.available || !this.config.enableGyro || !this.gyro.calibrated) return;\n\n    // Map gyro to controls\n    // Beta (tilt forward/back) -> elevator\n    this.controls.elevator = Math.max(-1, Math.min(1, this.gyro.beta / 30));\n    \n    // Gamma (tilt left/right) -> aileron\n    this.controls.aileron = Math.max(-1, Math.min(1, this.gyro.gamma / 30));\n  }\n\n  // ============================================\n  // Public API\n  // ============================================\n\n  /**\n   * Get current controls (call each frame)\n   */\n  getControls(): FlightControls {\n    // Poll gamepad each frame\n    this.updateGamepadControls();\n    \n    // Apply gyro\n    this.updateGyroControls();\n\n    return { ...this.controls };\n  }\n\n  /**\n   * Subscribe to control changes\n   */\n  onChange(callback: (controls: FlightControls) => void): void {\n    this.onControlChange = callback;\n  }\n\n  /**\n   * Calibrate gyro\n   */\n  calibrateGyro(): void {\n    this.gyro.calibrated = false;\n  }\n\n  /**\n   * Check if gyro is available\n   */\n  isGyroAvailable(): boolean {\n    return this.gyro.available;\n  }\n\n  /**\n   * Get gamepad state\n   */\n  getGamepadState(): GamepadState | null {\n    return this.gamepad;\n  }\n\n  private notifyChange(): void {\n    if (this.onControlChange) {\n      this.onControlChange(this.controls);\n    }\n  }\n\n  /**\n   * Destroy input manager\n   */\n  destroy(): void {\n    window.removeEventListener('keydown', this.handleKeyDown);\n    window.removeEventListener('keyup', this.handleKeyUp);\n    window.removeEventListener('mousemove', this.handleMouseMove);\n    window.removeEventListener('mousedown', this.handleMouseDown);\n    window.removeEventListener('mouseup', this.handleMouseUp);\n    window.removeEventListener('gamepadconnected', this.handleGamepadConnected);\n    window.removeEventListener('gamepaddisconnected', this.handleGamepadDisconnected);\n    window.removeEventListener('touchstart', this.handleTouchStart);\n    window.removeEventListener('touchmove', this.handleTouchMove);\n    window.removeEventListener('touchend', this.handleTouchEnd);\n    window.removeEventListener('deviceorientation', this.handleGyro);\n  }\n}\n","/**\n * ui - HUD + PFD + Debug Overlays\n * \n * Responsibilities:\n * - HUD: airspeed, altitude, VSI, heading\n * - Minimal PFD (Primary Flight Display)\n * - Debug overlays: state, FPS, physics step time, tiles loaded, memory\n * - Settings: performance tier toggle\n */\n\nimport type { FDMState } from '../fdm-jsbsim/index';\nimport type { PerformanceTier } from '../aircraft-render/index';\n\nexport interface UIConfig {\n  showHUD: boolean;\n  showPFD: boolean;\n  showDebug: boolean;\n  hudPosition: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\n}\n\nconst DEFAULT_CONFIG: UIConfig = {\n  showHUD: true,\n  showPFD: true,\n  showDebug: true,\n  hudPosition: 'top-left'\n};\n\ninterface PerformanceMetrics {\n  fps: number;\n  frameTime: number;\n  physicsTime: number;\n  tilesLoaded: number;\n  memoryEstimate: number;\n}\n\nexport class FlightUI {\n  private container: HTMLElement;\n  private config: UIConfig;\n  \n  // UI Elements\n  private hud: HTMLElement | null = null;\n  private pfd: HTMLElement | null = null;\n  private debug: HTMLElement | null = null;\n  private settings: HTMLElement | null = null;\n  \n  // Performance tracking\n  private lastFrameTime: number = 0;\n  private frameCount: number = 0;\n  private fpsUpdateTime: number = 0;\n  private currentFPS: number = 60;\n  \n  // Callbacks\n  private onTierChange: ((tier: PerformanceTier['name']) => void) | null = null;\n\n  constructor(container: HTMLElement, config: Partial<UIConfig> = {}) {\n    this.container = container;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.createUIElements();\n  }\n\n  private createUIElements(): void {\n    // HUD\n    if (this.config.showHUD) {\n      this.hud = document.createElement('div');\n      this.hud.className = 'flight-hud';\n      this.hud.innerHTML = `\n        <div class=\"hud-item airspeed\">\n          <span class=\"label\">IAS</span>\n          <span class=\"value\">---</span>\n          <span class=\"unit\">kts</span>\n        </div>\n        <div class=\"hud-item altitude\">\n          <span class=\"label\">ALT</span>\n          <span class=\"value\">---</span>\n          <span class=\"unit\">ft</span>\n        </div>\n        <div class=\"hud-item vsi\">\n          <span class=\"label\">V/S</span>\n          <span class=\"value\">---</span>\n          <span class=\"unit\">fpm</span>\n        </div>\n        <div class=\"hud-item heading\">\n          <span class=\"label\">HDG</span>\n          <span class=\"value\">---</span>\n          <span class=\"unit\">°</span>\n        </div>\n      `;\n      this.container.appendChild(this.hud);\n    }\n\n    // PFD\n    if (this.config.showPFD) {\n      this.pfd = document.createElement('div');\n      this.pfd.className = 'flight-pfd';\n      this.pfd.innerHTML = `\n        <canvas class=\"pfd-canvas\" width=\"300\" height=\"300\"></canvas>\n      `;\n      this.container.appendChild(this.pfd);\n    }\n\n    // Debug overlay\n    if (this.config.showDebug) {\n      this.debug = document.createElement('div');\n      this.debug.className = 'flight-debug';\n      this.debug.innerHTML = `\n        <div class=\"debug-item fps\">FPS: --</div>\n        <div class=\"debug-item frame-time\">Frame: --ms</div>\n        <div class=\"debug-item physics-time\">Physics: --ms</div>\n        <div class=\"debug-item tiles\">Tiles: 0</div>\n        <div class=\"debug-item memory\">Memory: --MB</div>\n      `;\n      this.container.appendChild(this.debug);\n    }\n\n    // Settings panel\n    this.settings = document.createElement('div');\n    this.settings.className = 'flight-settings';\n    this.settings.innerHTML = `\n      <div class=\"settings-title\">Settings</div>\n      <div class=\"settings-tier\">\n        <label>Quality:</label>\n        <select class=\"tier-select\">\n          <option value=\"low\">Low</option>\n          <option value=\"medium\">Medium</option>\n          <option value=\"high\" selected>High</option>\n        </select>\n      </div>\n      <div class=\"settings-controls\">\n        <button class=\"calibrate-gyro\">Calibrate Gyro</button>\n      </div>\n    `;\n    this.container.appendChild(this.settings);\n\n    // Add event listeners\n    this.setupEventListeners();\n  }\n\n  private setupEventListeners(): void {\n    const tierSelect = this.settings?.querySelector('.tier-select') as HTMLSelectElement;\n    tierSelect?.addEventListener('change', (e) => {\n      const value = (e.target as HTMLSelectElement).value as PerformanceTier['name'];\n      if (this.onTierChange) {\n        this.onTierChange(value);\n      }\n    });\n\n    const gyroButton = this.settings?.querySelector('.calibrate-gyro') as HTMLButtonElement;\n    gyroButton?.addEventListener('click', () => {\n      // Emit calibration event (handled externally)\n      window.dispatchEvent(new CustomEvent('gyro-calibrate'));\n    });\n  }\n\n  /**\n   * Update HUD with flight state\n   */\n  updateFlightState(state: FDMState): void {\n    if (!this.hud) return;\n\n    // Convert units\n    const iasKnots = state.airspeed * 1.94384; // m/s to knots\n    const altFeet = state.altitude * 3.28084;   // m to ft\n    const vsiFpm = 0; // Calculate from rate of climb\n    const headingDeg = (state.heading * 180 / Math.PI + 360) % 360;\n\n    // Update HUD elements\n    this.updateHudValue('.airspeed .value', iasKnots.toFixed(0));\n    this.updateHudValue('.altitude .value', altFeet.toFixed(0));\n    this.updateHudValue('.vsi .value', vsiFpm.toFixed(0));\n    this.updateHudValue('.heading .value', headingDeg.toFixed(0));\n\n    // Update PFD\n    this.updatePFD(state);\n  }\n\n  private updateHudValue(selector: string, value: string): void {\n    const element = this.hud?.querySelector(selector);\n    if (element) {\n      element.textContent = value;\n    }\n  }\n\n  /**\n   * Update PFD canvas\n   */\n  private updatePFD(state: FDMState): void {\n    const canvas = this.pfd?.querySelector('.pfd-canvas') as HTMLCanvasElement;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    const width = canvas.width;\n    const height = canvas.height;\n    const centerX = width / 2;\n    const centerY = height / 2;\n\n    // Clear\n    ctx.fillStyle = '#1a1a1a';\n    ctx.fillRect(0, 0, width, height);\n\n    // Pitch ladder\n    ctx.strokeStyle = '#00ff00';\n    ctx.lineWidth = 1;\n    \n    const pitch = state.pitch * 180 / Math.PI;\n    const roll = state.roll * 180 / Math.PI;\n    \n    // Draw pitch lines\n    for (let p = -90; p <= 90; p += 10) {\n      const yOffset = (pitch - p) * 3; // Scale factor\n      if (Math.abs(yOffset) < 100) {\n        const lineWidth = Math.abs(p) === 0 ? 60 : 40;\n        ctx.beginPath();\n        ctx.moveTo(centerX - lineWidth, centerY - yOffset);\n        ctx.lineTo(centerX + lineWidth, centerY - yOffset);\n        ctx.stroke();\n        \n        // Pitch label\n        ctx.fillStyle = '#00ff00';\n        ctx.font = '10px monospace';\n        ctx.fillText(p.toString(), centerX + lineWidth + 5, centerY - yOffset + 3);\n      }\n    }\n\n    // Draw roll pointer\n    ctx.save();\n    ctx.translate(centerX, 30);\n    ctx.rotate(-roll * Math.PI / 180);\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(-10, -15);\n    ctx.lineTo(10, -15);\n    ctx.closePath();\n    ctx.fillStyle = '#00ff00';\n    ctx.fill();\n    ctx.restore();\n\n    // Heading indicator at bottom\n    const heading = (state.heading * 180 / Math.PI + 360) % 360;\n    ctx.fillStyle = '#00ff00';\n    ctx.font = '12px monospace';\n    ctx.textAlign = 'center';\n    ctx.fillText(`HDG ${heading.toFixed(0)}°`, centerX, height - 20);\n\n    // Airspeed indicator on left\n    const ias = state.airspeed * 1.94384;\n    ctx.fillText(`${ias.toFixed(0)} kts`, 30, centerY);\n\n    // Altitude indicator on right\n    const alt = state.altitude * 3.28084;\n    ctx.fillText(`${alt.toFixed(0)} ft`, width - 30, centerY);\n  }\n\n  /**\n   * Update performance metrics\n   */\n  updatePerformance(metrics: PerformanceMetrics): void {\n    if (!this.debug) return;\n\n    this.updateDebugValue('.fps', `FPS: ${metrics.fps.toFixed(0)}`);\n    this.updateDebugValue('.frame-time', `Frame: ${metrics.frameTime.toFixed(1)}ms`);\n    this.updateDebugValue('.physics-time', `Physics: ${metrics.physicsTime.toFixed(1)}ms`);\n    this.updateDebugValue('.tiles', `Tiles: ${metrics.tilesLoaded}`);\n    this.updateDebugValue('.memory', `Memory: ${metrics.memoryEstimate.toFixed(0)}MB`);\n  }\n\n  private updateDebugValue(selector: string, value: string): void {\n    const element = this.debug?.querySelector(selector);\n    if (element) {\n      element.textContent = value;\n    }\n  }\n\n  /**\n   * Calculate FPS (call each frame)\n   */\n  tick(): void {\n    const now = performance.now();\n    this.frameCount++;\n\n    if (now - this.fpsUpdateTime >= 1000) {\n      this.currentFPS = this.frameCount * 1000 / (now - this.fpsUpdateTime);\n      this.frameCount = 0;\n      this.fpsUpdateTime = now;\n      \n      // Update debug with FPS\n      if (this.debug) {\n        this.updatePerformance({\n          fps: this.currentFPS,\n          frameTime: 1000 / this.currentFPS,\n          physicsTime: 0,\n          tilesLoaded: 0,\n          memoryEstimate: 0\n        });\n      }\n    }\n\n    this.lastFrameTime = now;\n  }\n\n  /**\n   * Subscribe to tier changes\n   */\n  onTierChangeCallback(callback: (tier: PerformanceTier['name']) => void): void {\n    this.onTierChange = callback;\n  }\n\n  /**\n   * Show/hide UI elements\n   */\n  setVisible(visible: boolean): void {\n    const elements = [this.hud, this.pfd, this.debug, this.settings];\n    elements.forEach(el => {\n      if (el) el.style.display = visible ? 'block' : 'none';\n    });\n  }\n\n  /**\n   * Destroy UI\n   */\n  destroy(): void {\n    const elements = [this.hud, this.pfd, this.debug, this.settings];\n    elements.forEach(el => {\n      if (el && el.parentNode) {\n        el.parentNode.removeChild(el);\n      }\n    });\n  }\n}\n\n// ============================================\n// CSS Styles (injected)\n// ============================================\n\nexport const UI_STYLES = `\n.flight-hud {\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  font-family: 'Courier New', monospace;\n  color: #00ff00;\n  background: rgba(0, 0, 0, 0.5);\n  padding: 15px;\n  border-radius: 8px;\n}\n\n.hud-item {\n  display: flex;\n  align-items: baseline;\n  gap: 8px;\n}\n\n.hud-item .label {\n  font-size: 12px;\n  opacity: 0.7;\n  width: 30px;\n}\n\n.hud-item .value {\n  font-size: 24px;\n  font-weight: bold;\n  width: 60px;\n  text-align: right;\n}\n\n.hud-item .unit {\n  font-size: 10px;\n  opacity: 0.7;\n}\n\n.flight-pfd {\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n}\n\n.pfd-canvas {\n  border-radius: 50%;\n  border: 2px solid #00ff00;\n}\n\n.flight-debug {\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  font-family: 'Courier New', monospace;\n  font-size: 12px;\n  color: #ffff00;\n  background: rgba(0, 0, 0, 0.7);\n  padding: 10px;\n  border-radius: 4px;\n}\n\n.debug-item {\n  margin-bottom: 4px;\n}\n\n.flight-settings {\n  position: absolute;\n  bottom: 20px;\n  left: 20px;\n  font-family: sans-serif;\n  color: white;\n  background: rgba(0, 0, 0, 0.7);\n  padding: 15px;\n  border-radius: 8px;\n}\n\n.settings-title {\n  font-weight: bold;\n  margin-bottom: 10px;\n}\n\n.settings-tier {\n  margin-bottom: 10px;\n}\n\n.settings-tier label {\n  margin-right: 8px;\n}\n\n.tier-select {\n  background: #333;\n  color: white;\n  border: 1px solid #555;\n  padding: 4px 8px;\n  border-radius: 4px;\n}\n\n.calibrate-gyro {\n  background: #444;\n  color: white;\n  border: 1px solid #666;\n  padding: 6px 12px;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.calibrate-gyro:hover {\n  background: #555;\n}\n`;\n","/**\n * sim-core - Fixed timestep physics loop\n * \n * Responsibilities:\n * - Fixed timestep accumulator pattern (60 Hz default)\n * - Pause/step/time scale controls\n * - Deterministic update order\n */\n\nexport interface SimState {\n  position: Vector3;\n  orientation: Quaternion;\n  velocity: Vector3;\n  angularVelocity: Vector3;\n  acceleration: Vector3;\n  deltaTime: number;\n  totalTime: number;\n}\n\nexport interface Vector3 {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface Quaternion {\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n}\n\nexport interface SimConfig {\n  fixedTimeStep: number;      // Default: 1/60 = 0.0167s\n  maxSubSteps: number;        // Default: 3\n  timeScale: number;          // Default: 1.0\n  paused: boolean;\n}\n\nexport type SimCallback = (state: SimState, dt: number) => void;\n\nexport class PhysicsLoop {\n  private accumulator: number = 0;\n  private state: SimState;\n  private config: SimConfig;\n  private callbacks: SimCallback[] = [];\n  private lastTime: number = 0;\n  private running: boolean = false;\n  private animationFrameId: number | null = null;\n\n  constructor(config: Partial<SimConfig> = {}) {\n    this.config = {\n      fixedTimeStep: 1 / 60,\n      maxSubSteps: 3,\n      timeScale: 1.0,\n      paused: false,\n      ...config\n    };\n\n    this.state = this.createInitialState();\n  }\n\n  private createInitialState(): SimState {\n    return {\n      position: { x: 0, y: 0, z: 0 },\n      orientation: { x: 0, y: 0, z: 0, w: 1 },\n      velocity: { x: 0, y: 0, z: 0 },\n      angularVelocity: { x: 0, y: 0, z: 0 },\n      acceleration: { x: 0, y: 0, z: 0 },\n      deltaTime: 0,\n      totalTime: 0\n    };\n  }\n\n  subscribe(callback: SimCallback): void {\n    this.callbacks.push(callback);\n  }\n\n  unsubscribe(callback: SimCallback): void {\n    this.callbacks = this.callbacks.filter(cb => cb !== callback);\n  }\n\n  start(): void {\n    if (this.running) return;\n    this.running = true;\n    this.lastTime = performance.now();\n    this.loop();\n  }\n\n  stop(): void {\n    this.running = false;\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n  }\n\n  pause(): void {\n    this.config.paused = true;\n  }\n\n  resume(): void {\n    this.config.paused = false;\n    this.lastTime = performance.now();\n  }\n\n  step(): void {\n    if (this.config.paused) return;\n    this.update(this.config.fixedTimeStep);\n  }\n\n  setTimeScale(scale: number): void {\n    this.config.timeScale = Math.max(0, Math.min(10, scale));\n  }\n\n  getState(): SimState {\n    return { ...this.state };\n  }\n\n  setState(state: Partial<SimState>): void {\n    Object.assign(this.state, state);\n  }\n\n  private loop = (): void => {\n    if (!this.running) return;\n\n    const currentTime = performance.now();\n    const frameTime = (currentTime - this.lastTime) / 1000;\n    this.lastTime = currentTime;\n\n    // Clamp frame time to avoid spiral of death\n    const clampedFrameTime = Math.min(frameTime, 0.25);\n\n    if (!this.config.paused) {\n      this.accumulator += clampedFrameTime * this.config.timeScale;\n\n      let steps = 0;\n      while (this.accumulator >= this.config.fixedTimeStep && steps < this.config.maxSubSteps) {\n        this.update(this.config.fixedTimeStep);\n        this.accumulator -= this.config.fixedTimeStep;\n        steps++;\n      }\n    }\n\n    this.animationFrameId = requestAnimationFrame(this.loop);\n  };\n\n  private update(dt: number): void {\n    this.state.deltaTime = dt;\n    this.state.totalTime += dt;\n\n    // Notify all subscribers\n    for (const callback of this.callbacks) {\n      callback(this.state, dt);\n    }\n  }\n}\n\n// Utility functions\nexport function vec3Add(a: Vector3, b: Vector3): Vector3 {\n  return { x: a.x + b.x, y: a.y + b.y, z: a.z + b.z };\n}\n\nexport function vec3Scale(v: Vector3, s: number): Vector3 {\n  return { x: v.x * s, y: v.y * s, z: v.z * s };\n}\n\nexport function quatMultiply(a: Quaternion, b: Quaternion): Quaternion {\n  return {\n    x: a.w * b.x + a.x * b.w + a.y * b.z - a.z * b.y,\n    y: a.w * b.y - a.x * b.z + a.y * b.w + a.z * b.x,\n    z: a.w * b.z + a.x * b.y - a.y * b.x + a.z * b.w,\n    w: a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z\n  };\n}\n\nexport function quatToEuler(q: Quaternion): Vector3 {\n  // Roll (x), Pitch (y), Yaw (z)\n  const sinr_cosp = 2 * (q.w * q.x + q.y * q.z);\n  const cosr_cosp = 1 - 2 * (q.x * q.x + q.y * q.y);\n  const roll = Math.atan2(sinr_cosp, cosr_cosp);\n\n  const sinp = 2 * (q.w * q.y - q.z * q.x);\n  const pitch = Math.abs(sinp) >= 1 ? Math.sign(sinp) * Math.PI / 2 : Math.asin(sinp);\n\n  const siny_cosp = 2 * (q.w * q.z + q.x * q.y);\n  const cosy_cosp = 1 - 2 * (q.y * q.y + q.z * q.z);\n  const yaw = Math.atan2(siny_cosp, cosy_cosp);\n\n  return { x: roll, y: pitch, z: yaw };\n}\n","/**\n * fdm-jsbsim - Flight Dynamics Model\n * \n * Responsibilities:\n * - JSBSim initialization and aircraft definition loading\n * - Control input -> FDM -> state output\n * - MUST run in Web Worker if it impacts frame time\n * \n * NOTE: If JSBSim WASM/JS port unavailable, use fallback aerodynamic model\n */\n\nimport type { Vector3, Quaternion } from '../sim-core/index';\n\nexport interface FlightControls {\n  throttle: number;      // 0-1\n  aileron: number;       // -1 to 1 (left to right)\n  elevator: number;      // -1 to 1 (nose down to nose up)\n  rudder: number;        // -1 to 1 (left to right)\n  flaps: number;         // 0-1\n  brakes: number;        // 0-1\n  gear: number;          // 0-1 (up to down)\n}\n\nexport interface FDMState {\n  position: Vector3;           // ECEF position\n  velocity: Vector3;           // m/s in body frame\n  orientation: Quaternion;\n  angularVelocity: Vector3;    // rad/s in body frame\n  airspeed: number;           // m/s\n  altitude: number;            // meters\n  heading: number;            // radians\n  pitch: number;              // radians\n  roll: number;               // radians\n}\n\nexport interface FDMAircraft {\n  name: string;\n  wingspan: number;           // meters\n  length: number;             // meters\n  mass: number;               // kg\n  maxThrust: number;          // Newtons\n  stallSpeed: number;         // m/s\n  serviceCeiling: number;     // meters\n}\n\nexport interface FDMConfig {\n  aircraft: FDMAircraft;\n  initialPosition: Vector3;   // ECEF\n  initialHeading: number;     // radians\n}\n\nexport type FDMStepFunction = (controls: FlightControls, dt: number) => FDMState;\n\n// ============================================\n// JSBSim Integration (if available)\n// ============================================\n\n/**\n * Initialize JSBSim with aircraft definition\n * Returns FDM step function\n */\nexport async function initJSBSim(config: FDMConfig): Promise<FDMStepFunction> {\n  // TODO: Check if jsbsim-wasm package available\n  // For now, fall back to simple aerodynamic model\n  console.warn('JSBSim WASM not available, using fallback aerodynamic model');\n  return initFallbackFDM(config);\n}\n\n// ============================================\n// Fallback Aerodynamic Model\n// ============================================\n\nfunction initFallbackFDM(config: FDMConfig): FDMStepFunction {\n  const { aircraft, initialPosition, initialHeading } = config;\n  \n  let state: FDMState = {\n    position: { ...initialPosition },\n    velocity: { x: 0, y: 0, z: 0 },\n    orientation: { x: 0, y: 0, z: Math.sin(initialHeading / 2), w: Math.cos(initialHeading / 2) },\n    angularVelocity: { x: 0, y: 0, z: 0 },\n    airspeed: 0,\n    altitude: initialPosition.z,\n    heading: initialHeading,\n    pitch: 0,\n    roll: 0\n  };\n\n  const gravity = 9.81;\n  const rho = 1.225; // air density at sea level\n\n  return (controls: FlightControls, dt: number): FDMState => {\n    const { throttle, aileron, elevator, rudder, flaps } = controls;\n    \n    // Calculate forces\n    const thrust = throttle * aircraft.maxThrust;\n    \n    // Lift coefficient (simplified)\n    const CL = 2 * Math.PI * elevator * (1 - flaps * 0.3);\n    \n    // Drag coefficient\n    const CD = 0.02 + CL * CL / (Math.PI * 6 * 0.8); // L/D ratio ~6\n    \n    // Dynamic pressure\n    const speed = Math.sqrt(\n      state.velocity.x ** 2 + \n      state.velocity.y ** 2 + \n      state.velocity.z ** 2\n    );\n    const q = 0.5 * rho * speed * speed;\n    const S = aircraft.wingspan * aircraft.length; // wing area estimate\n    \n    // Forces in body frame\n    const Fx = thrust - q * S * CD;\n    const Fy = q * S * CL * Math.cos(aileron * 0.5); // lift from wings\n    const Fz = q * S * CL * Math.sin(aileron * 0.5); // side force from roll\n    \n    // Apply forces (F = ma)\n    const ax = Fx / aircraft.mass;\n    const ay = Fy / aircraft.mass;\n    const az = -gravity + Fz / aircraft.mass; // gravity in body frame\n    \n    // Update velocity\n    state.velocity.x += ax * dt;\n    state.velocity.y += ay * dt;\n    state.velocity.z += az * dt;\n    \n    // Update position\n    state.position.x += state.velocity.x * dt;\n    state.position.y += state.velocity.y * dt;\n    state.position.z += state.velocity.z * dt;\n    \n    // Angular velocities from controls\n    const p = aileron * 2.0;  // roll rate\n    const q_rate = elevator * 1.5; // pitch rate\n    const r = rudder * 1.0;  // yaw rate\n    \n    state.angularVelocity.x += p * dt;\n    state.angularVelocity.y += q_rate * dt;\n    state.angularVelocity.z += r * dt;\n    \n    // Damping\n    state.angularVelocity.x *= 0.95;\n    state.angularVelocity.y *= 0.95;\n    state.angularVelocity.z *= 0.95;\n    \n    // Update orientation (simplified)\n    state.roll += state.angularVelocity.x * dt;\n    state.pitch += state.angularVelocity.y * dt;\n    state.heading += state.angularVelocity.z * dt;\n    \n    // Recompute quaternion from euler\n    const cr = Math.cos(state.roll / 2);\n    const sr = Math.sin(state.roll / 2);\n    const cp = Math.cos(state.pitch / 2);\n    const sp = Math.sin(state.pitch / 2);\n    const cy = Math.cos(state.heading / 2);\n    const sy = Math.sin(state.heading / 2);\n    \n    state.orientation = {\n      x: sr * cp * cy - cr * sp * sy,\n      y: cr * sp * cy + sr * cp * sy,\n      z: cr * cp * sy - sr * sp * cy,\n      w: cr * cp * cy + sr * sp * sy\n    };\n    \n    // Update derived values\n    state.airspeed = speed;\n    state.altitude = state.position.z;\n    \n    return { ...state };\n  };\n}\n\n// ============================================\n// A380 Aircraft Definition\n// ============================================\n\nexport const A380_AIRCRAFT: FDMAircraft = {\n  name: 'Airbus A380',\n  wingspan: 79.75,        // meters\n  length: 72.72,          // meters\n  mass: 276800,          // kg (MTOW)\n  maxThrust: 4 * 356000, // 4 engines × 356 kN\n  stallSpeed: 100,       // m/s (~195 knots)\n  serviceCeiling: 13100  // meters\n};\n\nexport function createA380Config(initialPosition: Vector3, heading: number = 0): FDMConfig {\n  return {\n    aircraft: A380_AIRCRAFT,\n    initialPosition,\n    initialHeading: heading\n  };\n}\n","/**\n * frames - Coordinate Systems & Conversions\n * \n * Responsibilities:\n * - Aircraft body frame (NED)\n * - Local tangent frame (NED or ENU - this file uses NED)\n * - Cesium world frame (ECEF + cartographic)\n * - Quaternion conventions (NED, right-handed)\n * \n * CONVENTIONS CHOSEN:\n * - Body frame: NED (North-East-Down) - right-handed\n * - Local tangent: NED\n * - World: ECEF (Earth-Centered, Earth-Fixed)\n * - Heading 0 = North, positive = clockwise (yaw)\n * - Pitch positive = nose up\n * - Roll positive = right wing down\n */\n\nimport type { Vector3, Quaternion } from '../sim-core/index';\n\n// ============================================\n// Constants\n// ============================================\n\nexport const WGS84_A = 6378137.0;           // Semi-major axis (m)\nexport const WGS84_F = 1 / 298.257223563;   // Flattening\nexport const WGS84_B = WGS84_A * (1 - WGS84_F); // Semi-minor axis\nexport const WGS84_E2 = 1 - (WGS84_B * WGS84_B) / (WGS84_A * WGS84_A); // First eccentricity squared\n\n// ============================================\n// ECEF <-> Geodetic Conversions\n// ============================================\n\nexport interface Cartographic {\n  longitude: number;   // radians\n  latitude: number;    // radians\n  height: number;      // meters above ellipsoid\n}\n\nexport function ecefToCartographic(ecef: Vector3): Cartographic {\n  const { x, y, z } = ecef;\n  \n  const p = Math.sqrt(x * x + y * y);\n  const lon = Math.atan2(y, x);\n  \n  let lat = Math.atan2(z, p * (1 - WGS84_E2));\n  let prevLat = 0;\n  let iter = 0;\n  \n  // Iterate to convergence\n  while (Math.abs(lat - prevLat) > 1e-12 && iter < 10) {\n    prevLat = lat;\n    const sinLat = Math.sin(lat);\n    const N = WGS84_A / Math.sqrt(1 - WGS84_E2 * sinLat * sinLat);\n    lat = Math.atan2(z + N * WGS84_E2 * sinLat, p);\n    iter++;\n  }\n  \n  const sinLat = Math.sin(lat);\n  const N = WGS84_A / Math.sqrt(1 - WGS84_E2 * sinLat * sinLat);\n  const h = p / Math.cos(lat) - N;\n  \n  return { longitude: lon, latitude: lat, height: h };\n}\n\nexport function cartographicToEcef(cartographic: Cartographic): Vector3 {\n  const { longitude, latitude, height } = cartographic;\n  \n  const sinLat = Math.sin(latitude);\n  const cosLat = Math.cos(latitude);\n  const N = WGS84_A / Math.sqrt(1 - WGS84_E2 * sinLat * sinLat);\n  \n  const x = (N + height) * cosLat * Math.cos(longitude);\n  const y = (N + height) * cosLat * Math.sin(longitude);\n  const z = (N * (1 - WGS84_E2) + height) * sinLat;\n  \n  return { x, y, z };\n}\n\n// ============================================\n// ECEF <-> Local NED Frame\n// ============================================\n\nexport interface LocalFrame {\n  origin: Vector3;      // ECEF origin\n  rotation: Quaternion; // NED to ECEF rotation\n}\n\n/**\n * Create local NED frame at given geodetic location\n */\nexport function createLocalFrame(originEcef: Vector3): LocalFrame {\n  const cart = ecefToCartographic(originEcef);\n  return {\n    origin: originEcef,\n    rotation: geodeticToNedQuaternion(cart.latitude, cart.longitude)\n  };\n}\n\n/**\n * Convert geodetic orientation to NED quaternion\n */\nfunction geodeticToNedQuaternion(lat: number, lon: number): Quaternion {\n  const cosLon = Math.cos(-lon);\n  const sinLon = Math.sin(-lon);\n  const cos90Lat = Math.cos(-(Math.PI / 2 - lat));\n  const sin90Lat = Math.sin(-(Math.PI / 2 - lat));\n  \n  // Combined rotation quaternion\n  return {\n    x: sinLon * sin90Lat,\n    y: -cosLon * sin90Lat,\n    z: cosLon * cos90Lat,\n    w: cosLon * cos90Lat + sinLon * sin90Lat\n  };\n}\n\n/**\n * Transform ECEF position to local NED\n */\nexport function ecefToNed(ecef: Vector3, frame: LocalFrame): Vector3 {\n  // Translate\n  const dx = ecef.x - frame.origin.x;\n  const dy = ecef.y - frame.origin.y;\n  const dz = ecef.z - frame.origin.z;\n  \n  // Rotate by inverse of frame rotation (conjugate for unit quat)\n  const q = frame.rotation;\n  const qConj = { x: -q.x, y: -q.y, z: -q.z, w: q.w };\n  \n  return rotateVectorByQuaternion({ x: dx, y: dy, z: dz }, qConj);\n}\n\n/**\n * Transform local NED position to ECEF\n */\nexport function nedToEcef(ned: Vector3, frame: LocalFrame): Vector3 {\n  // Rotate\n  const rotated = rotateVectorByQuaternion(ned, frame.rotation);\n  \n  // Translate\n  return {\n    x: frame.origin.x + rotated.x,\n    y: frame.origin.y + rotated.y,\n    z: frame.origin.z + rotated.z\n  };\n}\n\n/**\n * Rotate vector by quaternion\n */\nfunction rotateVectorByQuaternion(v: Vector3, q: Quaternion): Vector3 {\n  const qv = { x: q.x, y: q.y, z: q.z };\n  const uv = cross(qv, v);\n  const uuv = cross(qv, uv);\n  \n  return {\n    x: v.x + 2 * (q.w * uv.x + uuv.x),\n    y: v.y + 2 * (q.w * uv.y + uuv.y),\n    z: v.z + 2 * (q.w * uv.z + uuv.z)\n  };\n}\n\nfunction cross(a: Vector3, b: Vector3): Vector3 {\n  return {\n    x: a.y * b.z - a.z * b.y,\n    y: a.z * b.x - a.x * b.z,\n    z: a.x * b.y - a.y * b.x\n  };\n}\n\n// ============================================\n// Body Frame <-> NED Frame\n// ============================================\n\n/**\n * Aircraft body frame is NED-aligned when orientation is neutral\n * Body +X = forward (nose)\n * Body +Y = right (starboard wing)\n * Body +Z = down\n */\n\n/**\n * Convert body-frame velocity to NED\n */\nexport function bodyToNedVelocity(bodyVel: Vector3, orientation: Quaternion): Vector3 {\n  return rotateVectorByQuaternion(bodyVel, orientation);\n}\n\n/**\n * Convert NED velocity to body frame\n */\nexport function nedToBodyVelocity(nedVel: Vector3, orientation: Quaternion): Vector3 {\n  // Inverse rotation = conjugate\n  const qConj = { x: -orientation.x, y: -orientation.y, z: -orientation.z, w: orientation.w };\n  return rotateVectorByQuaternion(nedVel, qConj);\n}\n\n/**\n * Convert body-frame angular velocity to NED rates (heading/pitch/roll)\n */\nexport function bodyAngularToEulerRates(\n  bodyRates: Vector3, \n  orientation: Quaternion\n): Vector3 {\n  // Simplified conversion\n  const euler = quatToEuler(orientation);\n  const roll = euler.x;\n  const pitch = euler.y;\n  \n  const cosRoll = Math.cos(roll);\n  const sinRoll = Math.sin(roll);\n  const tanPitch = Math.tan(pitch);\n  const secPitch = 1 / Math.cos(pitch);\n  \n  return {\n    x: bodyRates.x + sinRoll * tanPitch * bodyRates.y + cosRoll * tanPitch * bodyRates.z,\n    y: cosRoll * bodyRates.y - sinRoll * bodyRates.z,\n    z: sinRoll * secPitch * bodyRates.y + cosRoll * secPitch * bodyRates.z\n  };\n}\n\n// ============================================\n// Utility Functions\n// ============================================\n\nfunction quatToEuler(q: Quaternion): Vector3 {\n  const sinr_cosp = 2 * (q.w * q.x + q.y * q.z);\n  const cosr_cosp = 1 - 2 * (q.x * q.x + q.y * q.y);\n  const roll = Math.atan2(sinr_cosp, cosr_cosp);\n\n  const sinp = 2 * (q.w * q.y - q.z * q.x);\n  const pitch = Math.abs(sinp) >= 1 ? Math.sign(sinp) * Math.PI / 2 : Math.asin(sinp);\n\n  const siny_cosp = 2 * (q.w * q.z + q.x * q.y);\n  const cosy_cosp = 1 - 2 * (q.y * q.y + q.z * q.z);\n  const yaw = Math.atan2(siny_cosp, cosy_cosp);\n\n  return { x: roll, y: pitch, z: yaw };\n}\n\n/**\n * Calculate distance between two ECEF positions (meters)\n */\nexport function ecefDistance(a: Vector3, b: Vector3): number {\n  const dx = b.x - a.x;\n  const dy = b.y - a.y;\n  const dz = b.z - a.z;\n  return Math.sqrt(dx * dx + dy * dy + dz * dz);\n}\n\n/**\n * Calculate bearing from point A to point B (radians, 0 = North)\n */\nexport function ecefBearing(from: Vector3, to: Vector3): number {\n  const fromCart = ecefToCartographic(from);\n  const toCart = ecefToCartographic(to);\n  \n  const dLon = toCart.longitude - fromCart.longitude;\n  const y = Math.sin(dLon) * Math.cos(toCart.latitude);\n  const x = Math.cos(fromCart.latitude) * Math.sin(toCart.latitude) -\n            Math.sin(fromCart.latitude) * Math.cos(toCart.latitude) * Math.cos(dLon);\n  \n  return Math.atan2(y, x);\n}\n","/**\n * Massive Web Flight Simulator - Main Entry Point\n * \n * A380 Cockpit-First Flight Simulator\n * Built with CesiumJS + TypeScript\n */\n\nimport { CesiumWorld, CameraMode } from './world-cesium/index';\nimport { AircraftRenderer } from './aircraft-render/index';\nimport { InputManager } from './input/index';\nimport { FlightUI, UI_STYLES } from './ui/index';\nimport { PhysicsLoop } from './sim-core/index';\nimport { createA380Config, FlightControls, FDMState } from './fdm-jsbsim/index';\nimport { cartographicToEcef, ecefToCartographic, createLocalFrame } from './frames/index';\n\nimport type { PerformanceTier } from './aircraft-render/index';\n\n// ============================================\n// Configuration\n// ============================================\n\ninterface SimulatorConfig {\n  cesiumIonToken?: string;\n  initialPosition: {\n    latitude: number;\n    longitude: number;\n    altitude: number;\n  };\n  initialHeading: number;\n  performanceTier: PerformanceTier['name'];\n}\n\nconst DEFAULT_CONFIG: SimulatorConfig = {\n  // User must provide their own Cesium ion token\n  cesiumIonToken: undefined,\n  initialPosition: {\n    latitude: 1.3644,  // Singapore\n    longitude: 103.9915,\n    altitude: 1000     // meters\n  },\n  initialHeading: 90,  // East\n  performanceTier: 'high'\n};\n\n// ============================================\n// Main Simulator Class\n// ============================================\n\nexport class FlightSimulator {\n  private container: HTMLElement;\n  private config: SimulatorConfig;\n  \n  // Core systems\n  private world: CesiumWorld;\n  private aircraft: AircraftRenderer;\n  private input: InputManager;\n  private ui: FlightUI;\n  private physics: PhysicsLoop;\n  \n  // State\n  private fdmState: FDMState;\n  private fdmStep: ((controls: FlightControls, dt: number) => FDMState) | null = null;\n  private running: boolean = false;\n\n  constructor(container: HTMLElement, config: Partial<SimulatorConfig> = {}) {\n    this.container = container;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    \n    // Initialize systems\n    this.world = new CesiumWorld();\n    this.aircraft = new AircraftRenderer({\n      scale: 1.0,\n      minimumPixelSize: 128\n    });\n    \n    this.input = new InputManager();\n    \n    this.ui = new FlightUI(container, {\n      showHUD: true,\n      showPFD: true,\n      showDebug: true\n    });\n    \n    this.physics = new PhysicsLoop({\n      fixedTimeStep: 1 / 60,\n      maxSubSteps: 3\n    });\n\n    // Calculate initial position in ECEF\n    const initialEcef = cartographicToEcef({\n      longitude: this.config.initialPosition.longitude * Math.PI / 180,\n      latitude: this.config.initialPosition.latitude * Math.PI / 180,\n      height: this.config.initialPosition.altitude\n    });\n\n    // Create FDM config\n    const fdmConfig = createA380Config(\n      initialEcef,\n      this.config.initialHeading * Math.PI / 180\n    );\n\n    // Initialize FDM (with fallback)\n    this.fdmStep = null; // Will be set after init\n\n    // Set initial state\n    this.fdmState = {\n      position: initialEcef,\n      velocity: { x: 0, y: 0, z: 0 },\n      orientation: { x: 0, y: 0, z: Math.sin(this.config.initialHeading / 2), w: Math.cos(this.config.initialHeading / 2) },\n      angularVelocity: { x: 0, y: 0, z: 0 },\n      airspeed: 0,\n      altitude: this.config.initialPosition.altitude,\n      heading: this.config.initialHeading * Math.PI / 180,\n      pitch: 0,\n      roll: 0\n    };\n  }\n\n  /**\n   * Initialize the simulator\n   */\n  async initialize(): Promise<void> {\n    // Inject UI styles\n    this.injectStyles();\n\n    // Initialize Cesium world\n    await this.world.initialize(this.container, {\n      ionToken: this.config.cesiumIonToken,\n      terrainProvider: 'default',\n      imageryProvider: 'bing',\n      enable3DTiles: true\n    });\n\n    // Set cockpit camera by default\n    this.world.setCameraMode({ type: 'cockpit' });\n\n    // Subscribe to physics updates\n    this.physics.subscribe(this.updatePhysics);\n\n    // Subscribe to UI tier changes\n    this.ui.onTierChangeCallback((tier) => {\n      this.setPerformanceTier(tier);\n    });\n\n    // Listen for gyro calibration\n    window.addEventListener('gyro-calibrate', () => {\n      this.input.calibrateGyro();\n    });\n\n    console.log('Flight Simulator initialized');\n  }\n\n  /**\n   * Start the simulator\n   */\n  start(): void {\n    if (this.running) return;\n    this.running = true;\n    this.physics.start();\n    console.log('Simulator started');\n  }\n\n  /**\n   * Stop the simulator\n   */\n  stop(): void {\n    this.running = false;\n    this.physics.stop();\n  }\n\n  /**\n   * Set camera mode\n   */\n  setCameraMode(mode: 'chase' | 'cockpit' | 'free'): void {\n    const cameraMode: CameraMode = { type: mode };\n    if (mode === 'chase') {\n      cameraMode.distance = 50;\n    }\n    this.world.setCameraMode(cameraMode);\n  }\n\n  /**\n   * Set performance tier\n   */\n  setPerformanceTier(tier: PerformanceTier['name']): void {\n    this.aircraft.setTier(tier);\n    this.world.setTerrainQuality(tier === 'low' ? 'low' : tier === 'medium' ? 'medium' : 'high');\n  }\n\n  /**\n   * Load aircraft model\n   */\n  async loadAircraft(modelUrl: string): Promise<void> {\n    await this.aircraft.load(this.world.getViewer()!.models);\n  }\n\n  /**\n   * Physics update callback\n   */\n  private updatePhysics = (state, dt): void => {\n    // Get input controls\n    const controls = this.input.getControls();\n\n    // Step FDM if available\n    if (this.fdmStep) {\n      this.fdmState = this.fdmStep(controls, dt);\n    } else {\n      // Fallback: simple movement\n      this.updateSimplePhysics(controls, dt);\n    }\n\n    // Update world\n    this.world.updateAircraft(this.fdmState.position, this.fdmState.orientation);\n\n    // Update UI\n    this.ui.updateFlightState(this.fdmState);\n    this.ui.tick();\n  };\n\n  /**\n   * Simple physics fallback\n   */\n  private updateSimplePhysics(controls: FlightControls, dt: number): void {\n    const speed = 50; // m/s\n    const turnRate = 0.5;\n\n    // Update heading\n    this.fdmState.heading += controls.rudder * turnRate * dt;\n    this.fdmState.roll = controls.aileron * 0.5;\n    this.fdmState.pitch = controls.elevator * 0.3;\n\n    // Update position based on heading\n    const heading = this.fdmState.heading;\n    const pitch = this.fdmState.pitch;\n    \n    this.fdmState.velocity.x = Math.cos(heading) * Math.cos(pitch) * speed;\n    this.fdmState.velocity.y = Math.sin(heading) * Math.cos(pitch) * speed;\n    this.fdmState.velocity.z = -Math.sin(pitch) * speed;\n\n    this.fdmState.position.x += this.fdmState.velocity.x * dt;\n    this.fdmState.position.y += this.fdmState.velocity.y * dt;\n    this.fdmState.position.z += this.fdmState.velocity.z * dt;\n\n    // Update altitude\n    this.fdmState.altitude = this.fdmState.position.z;\n    this.fdmState.airspeed = speed;\n\n    // Update orientation quaternion\n    const roll = this.fdmState.roll;\n    const pitchQ = this.fdmState.pitch;\n    const yaw = this.fdmState.heading;\n\n    const cr = Math.cos(roll / 2);\n    const sr = Math.sin(roll / 2);\n    const cp = Math.cos(pitchQ / 2);\n    const sp = Math.sin(pitchQ / 2);\n    const cy = Math.cos(yaw / 2);\n    const sy = Math.sin(yaw / 2);\n\n    this.fdmState.orientation = {\n      x: sr * cp * cy - cr * sp * sy,\n      y: cr * sp * cy + sr * cp * sy,\n      z: cr * cp * sy - sr * sp * cy,\n      w: cr * cp * cy + sr * sp * sy\n    };\n  }\n\n  /**\n   * Inject CSS styles\n   */\n  private injectStyles(): void {\n    const style = document.createElement('style');\n    style.textContent = UI_STYLES;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * Destroy simulator\n   */\n  destroy(): void {\n    this.stop();\n    this.world.destroy();\n    this.aircraft.destroy();\n    this.input.destroy();\n    this.ui.destroy();\n  }\n}\n\n// ============================================\n// Auto-initialize on DOM ready\n// ============================================\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n  // Check for container\n  const container = document.getElementById('flight-sim');\n  if (!container) {\n    console.error('Flight simulator container not found');\n    return;\n  }\n\n  // Check for Cesium ion token\n  const cesiumToken = (window as any).__CESIUM_ION_TOKEN__;\n  if (!cesiumToken) {\n    console.warn('Cesium ion token not provided. Set window.__CESIUM_ION_TOKEN__');\n  }\n\n  // Create and initialize simulator\n  const sim = new FlightSimulator(container, {\n    cesiumIonToken: cesiumToken,\n    performanceTier: 'high'\n  });\n\n  await sim.initialize();\n\n  // Try to load aircraft model (will fail without actual GLB)\n  try {\n    // Placeholder URL - user must replace with actual model\n    // await sim.loadAircraft('/assets/a380.glb');\n  } catch (e) {\n    console.log('Aircraft model not loaded (placeholder)');\n  }\n\n  // Start simulator\n  sim.start();\n\n  // Expose for debugging\n  (window as any).flightSim = sim;\n});\n"],"names":["DEFAULT_CONFIG","CesiumWorld","container","config","cfg","Cesium","url","position","orientation","cesiumPos","hpr","q","sinr_cosp","cosr_cosp","roll","sinp","pitch","siny_cosp","cosy_cosp","mode","longitude","latitude","height","PERFORMANCE_TIERS","AircraftRenderer","cesiumEntities","tierName","InputManager","e","b","i","touch","start","dx","dy","throttle","aileron","elevator","rudder","flaps","brakes","gear","gp","callback","FlightUI","value","state","iasKnots","altFeet","vsiFpm","headingDeg","selector","element","canvas","ctx","width","centerX","centerY","p","yOffset","lineWidth","heading","ias","alt","metrics","now","visible","el","UI_STYLES","PhysicsLoop","cb","scale","currentTime","frameTime","clampedFrameTime","steps","dt","A380_AIRCRAFT","createA380Config","initialPosition","WGS84_A","WGS84_F","WGS84_B","WGS84_E2","cartographicToEcef","cartographic","sinLat","cosLat","N","x","y","z","FlightSimulator","initialEcef","tier","cameraMode","modelUrl","controls","pitchQ","yaw","cr","sr","cp","sp","cy","sy","style","cesiumToken","sim"],"mappings":"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"}